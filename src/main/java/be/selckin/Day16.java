package be.selckin;

import java.io.IOException;
import java.util.*;

public class Day16 {

    public static final String PART1_EXAMPLE = """
            .|...\\....
            |.-.\\.....
            .....|-...
            ........|.
            ..........
            .........\\
            ..../.\\\\..
            .-.-/..|..
            .|....-|.\\
            ..//.|....
            """;

    public static void main(String[] args) throws IOException {
        part1(PART1_EXAMPLE, 46);
        part1(PART1_INPUT, 7111);
        System.out.println("==============");
        part2(PART1_EXAMPLE, 51);
        part2(PART1_INPUT, 7831);
    }


    public enum Direction {
        UP, DOWN, LEFT, RIGHT
    }


    public record Beam(Direction dir, int x, int y) {
    }


    private static void part2(String input, long expected) {
        var grid = parse(input);

        List<Beam> startBeams = new ArrayList<>();


        for (int y = 0; y < grid.length; y++) {
            startBeams.add(new Beam(Direction.RIGHT, -1, y));
            startBeams.add(new Beam(Direction.LEFT, grid[y].length, y));
        }


        for (int x = 0; x < grid[0].length; x++) {
            startBeams.add(new Beam(Direction.DOWN, x, -1));

            startBeams.add(new Beam(Direction.UP, x, grid.length));
        }


        int sum = 0;
        for (Beam beam : startBeams) {
            sum = Math.max(sum, calc(grid, beam));
        }


        if (sum != expected)
            throw new RuntimeException("" + sum);
    }

    private static void part1(String input, long expected) {
        var grid = parse(input);

        int sum = calc(grid, new Beam(Direction.RIGHT, -1, 0));


        if (sum != expected)
            throw new RuntimeException("" + sum);
    }

    private static int calc(char[][] grid, Beam start) {
        int[][] energized = new int[grid.length][grid[0].length];

        List<Beam> beams = new ArrayList<>();
        beams.add(start);
        Set<Beam> seen = new HashSet<>();

        while (!beams.isEmpty()) {
            List<Beam> newBeams = new ArrayList<>();
            for (Beam beam : beams) {
                if (!seen.add(beam)) {
                    continue;
                }
                Direction dir = beam.dir;
                int x = beam.x;
                int y = beam.y;

                switch (dir) {
                    case UP -> y--;
                    case DOWN -> y++;
                    case LEFT -> x--;
                    case RIGHT -> x++;
                }
                if (x < 0 || x >= grid[0].length || y < 0 || y >= grid.length) {
                    continue;
                }
                energized[y][x] = 1;

                switch (grid[y][x]) {
                    case '.' -> newBeams.add(new Beam(dir, x, y));
                    case '|' -> {
                        switch (dir) {
                            case LEFT, RIGHT -> {
                                newBeams.add(new Beam(Direction.UP, x, y));
                                newBeams.add(new Beam(Direction.DOWN, x, y));
                            }
                            case UP, DOWN -> newBeams.add(new Beam(dir, x, y));
                        }
                    }
                    case '-' -> {
                        switch (dir) {
                            case UP, DOWN -> {
                                newBeams.add(new Beam(Direction.LEFT, x, y));
                                newBeams.add(new Beam(Direction.RIGHT, x, y));
                            }
                            case LEFT, RIGHT -> newBeams.add(new Beam(dir, x, y));
                        }
                    }
                    case '\\' -> {
                        newBeams.add(new Beam(switch (dir) {
                            case UP -> Direction.LEFT;
                            case DOWN -> Direction.RIGHT;
                            case LEFT -> Direction.UP;
                            case RIGHT -> Direction.DOWN;
                        }, x, y));
                    }
                    case '/' -> {
                        newBeams.add(new Beam(switch (dir) {
                            case UP -> Direction.RIGHT;
                            case DOWN -> Direction.LEFT;
                            case LEFT -> Direction.DOWN;
                            case RIGHT -> Direction.UP;
                        }, x, y));
                    }
                }
            }
            beams = newBeams;

        }


        int sum = 0;
        for (int[] ints : energized)
            for (int value : ints)
                sum += value;
        return sum;
    }


    private static char[][] parse(String input) {
        List<String> lines = input.lines().toList();

        char[][] grid = new char[lines.size()][lines.get(0).length()];
        for (int i = 0; i < lines.size(); i++) {
            String line = lines.get(i);
            grid[i] = line.toCharArray();
        }
        return grid;
    }


    public static final String PART1_INPUT = """
            \\................\\......-.........................../..............|.\\..-.................-......../..........
            ..\\................\\...........|.|../......\\......../../...........|.......\\....../.......\\....../............
            |......|./......../..........|\\.......|/..|...............................|...............|...................
            ...................\\.-.............................../.......\\.....\\..............././.......\\...........|....
            ................\\......................|...|\\............../........./...................\\......./......./....
            -......\\/..\\/../...............................................\\....\\........\\...............-....\\......-....
            ....\\......-......................-..|...........................-.|...-..........\\................./.........
            .......|..........\\....|/................................/........................-/.\\...-/................../
            ..\\...-..../......................\\./..........|-/......\\...............|...|.............................|...
            \\................................\\....|...........|......................|..........|.............../........-
            |..../......\\.....\\................../............../..\\.....|..............................................-.
            .\\...........\\.-....|.....-..|......|..............\\.....\\...-......./..................../\\....|.../\\........
            ...........|.......-..\\...............\\................................../...........................\\........
            .........-.................../...................../.-../.........|...\\..........-..........\\........|........
            ../...../../.|......-.....|\\...../.......\\......-.........-............./....................../..............
            .-....../.............-...../...........\\........-.......\\...............-|......\\.....|....\\.................
            ......................./..............................\\.....\\...-................................./...........
            ./.....\\.........\\-..-...-..\\...................\\......./....|.|.-..........|......./.........................
            .................................-...............\\...../....../..\\..-......................|..................
            ...\\.................\\...\\............\\-.....................\\...........-..............................-.....
            .....-....-|......\\..../...........-.................../............-.................../............-....|...
            .....-..\\.....................-............/..../..........-.../..........................-.......\\...........
            ..|..........................-................|-..-..............|....................../.....|......|........
            .\\...........................\\......//.....-..-............/.....................................././........-
            ....../...\\.......................\\/.\\.../.........\\......................................-.....\\......./.....
            .....|........../..................................../....-....................|....\\........-.........../../.
            .............|....\\...................................|.....|./..........|...........................-.|......
            ......................................./........./..................-.......|...............\\..../....|.......
            .../....//.\\...............\\.....|..|...-......|.......-|.../.-....-..\\........\\...../.....|..................
            ............./...................................|.............../.|...................-..........-...........
            ...../....|.................................................|........\\...........................-....../.|...
            ...\\.....\\.....................|/.-....\\.....|.|...--...../...\\......................../.........|............
            ../...................../|................/......\\...|..\\|............-../........-............./......./.....
            ...............|...................\\-.................\\......-/.|......./.......-....../........../....-......
            .-/-.....|...|......../...\\.|........-....................\\..-.......-.............................|.-/.\\.....
            ................-......|.....\\...--................./....-..|.../............./.....\\........../.........|....
            .................\\...\\...........|........................\\...............././........|\\......./.............-
            ......\\....\\..................................././...|..|...............-.....||..............................
            ..../|.\\-............./././....../-./.-..........-...............-..\\...........|................../..........
            ..........\\.-....|....\\.|...............\\.......\\.........\\./.....|...|........|.........-.................|-.
            .|.\\......................\\......-....-....-...............\\.....-.\\............./|-...-./....../.......-.....
            .........\\......../.|.-.../.-...............-..-.......|......\\...\\..|..................................../...
            /./.......|.\\.....................................-...-.|......-/...........-..................../.........\\..
            ...-..\\........-................\\...|.|....../...............|................................................
            .....................................-......\\...-.../..\\....|..................\\.........................-....
            -........|...........-...........|//................|.....-..........|..-....../\\..|../..-....\\..\\....../.....
            .|............../.\\...................................\\..|....|..\\..............|................/...-.../-...
            ........./.......|.|.................................|\\....\\|........\\........|........|.....................\\
            ..\\....../....|......../.......\\|.............\\........................./............/..../...............-...
            .....-........-............/../....-...............-.../......../../..-...........\\.....\\.......-...-.......-.
            ........|...../-....-......\\.............................-..|\\.....\\.....\\-..............\\.......|............
            ......................................../.......-..\\..........\\.............|....-.....\\/........./.|.....|...
            ..............-...................-.-...-............../...../.....\\./........./.-....................-.......
            ................|........../\\..../......................-.......-............\\.|..|......../.........\\-.......
            ........|.........\\..........................................-....||..-..\\.................-....../..-.......\\
            .....\\.............../..\\./.........\\|.\\.....-|..-..|...../.............../.........-.........................
            ...|......................//......./..........-...................\\......|...../......................|..|....
            ....\\..................|..............\\........\\........../..-.......-...-|...\\../...../........-........./...
            ...|\\.|.......\\...........\\.-.................|.........\\/-...............//.......\\................-./......|
            .........................-/...-./........./.\\.|.......\\...\\.........\\....................\\.....-....-.........
            ......\\..\\....../.\\........./..........-......./.-.............................\\\\.............................
            ....................../......\\|../....................-.................../..............-..\\|.../............
            ...........\\.......|.|.......................|.....................\\../........../.-.........|................
            ...................../.||..........-..../.....-.................|\\............................................
            ..\\...\\.....-./..........|......-...../.....................................................|................\\
            ....................-.\\............|../..............|..\\\\...........|.....|....-../..........-.....-.........
            ............................./...............-.........................\\...\\.|...\\.............|...-...|......
            .............|.............................|...................|...................\\.................../...../
            ...\\.....\\.....................-............................/..........|....|..\\...........|.|................
            ........./.......-.\\./........................../...........................................|../....../|..\\...
            ....../.........................\\...../..-...\\................/...-........\\....../../......|.................
            ......./.-.../..-..........|......................................-....\\-/.-...........|....-..\\...........-..
            .....-...........||\\...|.......|.................\\........../-.............../................-...............
            |.-.............\\............\\.....-|...././..................................-|........-/..........-.....|...
            \\...................\\........./.\\...|..........\\.|......-....-.-.........\\...............|.../-.........\\.....
            .........../...........|.........|........................|.......................|..-.......................|
            ..|..................-......-..................-..............................\\\\............-....|............
            ..........|..........\\......................................\\...................-..................|..........
            ...../.........|.......................................\\..././...|\\................/...................|......
            ........\\.|....................\\\\......|..............................\\....../.-/...\\.......................-.
            ...........\\.............|....\\..|......../.....././|..../........\\.....|.................\\.........|...-.....
            .....................\\......./\\......|............../...........-..........\\..................\\\\...........\\..
            ................................................\\.../.....................-...../\\|............\\-.............
            ...........\\...............-........\\................\\................./...|....\\.....................\\...../.
            ......\\........|.....-....................\\../..............-...............-..............-..................
            .....-............|....................\\......\\..|.....././...../\\.....|...\\...............................-.-
            ........././......-.-..../....|..|../..................../...-......................-.......................|.
            .................................//....|............-........../.../.......................\\......-...........
            ................../................|...................................\\......./...-............./............
            ..|.............../.....-................-..|-.........../.....................\\/.........\\.../.........|.....
            .........................../|.../....-..\\-...../................./..........................|...............\\.
            .....|.........../..\\........../......./........-..............|............|......................-..........
            ....|......................................-..|.-../........................-..............\\.........-........
            .-......-....................-.................././.........................-...|-......................|.....
            ...-......./........../...........................-........\\.........|......-...........-.-...................
            ..........-.|.|.....\\..-..-...\\-..../.................|..|..-.......\\..................|...|.......-..........
            \\...........-|....-..........................\\................................|.......|...\\.......\\-........./
            ./........./-.-............\\...-\\.-.......................................\\-.......................\\..........
            ........|..........\\\\.....\\.-.../............-................|.............-.-..-.....\\.......-.....\\-.......
            ...................\\.......|...../.-...............\\.../......../................../............\\...|.........
            ..\\..........|........-.-.......|...../..../....-...........|............|................\\/../.........../...
            ...............\\..|./............................................................/............/...............
            ..\\........|/.|......|.............\\.............\\.....................|.....\\..........|......|..............
            .............-......|......|\\....................\\...|..........\\\\.........|.|....../..../..........\\.......\\.
            ../..|..................-................................................//........|..../-..-/..../.\\.........
            ..\\............./..........-..|......./-............../....|...............|.....................|.....--\\....
            ....-|.\\..|....|............./..........\\-.......|........|....|..-................................-./..\\\\...\\
            ....|..\\.......................\\......./.-............................||....-...................\\......./.....
            .|-.......................-...........|..........\\.../.......\\......\\....................-\\./.................
            ...................................................|.....................|....................................    
            """;

}



